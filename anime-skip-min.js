!function(){"use strict";var n="https://api.anime-skip.com/graphql",e="ZGfO0sMF3eCwLYf8yMSCJjlynwNGRXWE",t=["Intro","New Intro","Op","Opening","Recap","Credits","New Credits","Ed","Ending","Preview"];function r(t){return fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Client-ID":e},body:JSON.stringify({query:t})}).then((function(n){return n.json()})).then((function(n){if(n.errors)throw new Error(n.errors[0].message);return n.data}))}function i(n){return r('{ searchShows(search: "'+n+'", limit: 1) { id name } }').then((function(n){return n.searchShows&&n.searchShows.length>0?n.searchShows[0].id:null})).catch((function(){return null}))}function a(n){var e=[];n.original_title&&e.push(n.original_title),n.original_name&&e.push(n.original_name),n.title&&e.push(n.title),n.name&&e.push(n.name),e=e.filter((function(n,t){return e.indexOf(n)===t&&n}));var t=Promise.resolve(null);return e.forEach((function(n){t=t.then((function(e){return e||i(n)}))})),t=t.then((function(e){return e||function(n){return new Promise((function(e){if(!window.Lampa||!window.Lampa.TMDB)return e(null);var t=n.name||n.original_name?"tv":"movie",r=n.id;if(!r)return e(null);var i=Lampa.TMDB.api(t+"/"+r+"?api_key="+Lampa.TMDB.key()+"&language=en-US");fetch(i).then((function(n){return n.json()})).then((function(n){e(n.name||n.title)})).catch((function(){e(null)}))}))}(n).then((function(n){return n?i(n).then((function(e){if(e)return e;var t,r=(t=n)?t.replace(/\(\d{4}\)/g,"").replace(/\(TV\)/gi,"").replace(/Season \d+/gi,"").replace(/[:\-]/g," ").replace(/\s+/g," ").trim():"";return r!==n?i(r):null})):null}))})),t}function o(n,e){n&&"object"==typeof n&&(n.segments&&"object"==typeof n.segments&&!Array.isArray(n.segments)||(n.segments={}),n.segments.skip&&Array.isArray(n.segments.skip)||(n.segments.skip=[]),e.forEach((function(e){n.segments.skip.some((function(n){return n.start===e.start}))||n.segments.skip.push(e)})))}function s(n){return new Promise((function(e,i){var s=n.movie||n.card;if(!s){var u=Lampa.Activity.active();u&&(s=u.movie||u.card)}if(!s)return e();var c=(s.original_language||"").toLowerCase();if(c&&"ja"!==c&&"zh"!==c)return e();var f=n.episode||n.e||n.episode_number;f||(s.number_of_seasons>0||s.original_name&&!s.original_title||(f=1));f||(f=1),a(s).then((function(n){return n?function(n,e){return r('{ searchEpisodes(search: "", showId: "'+n+'", limit: 100) { number timestamps { at type { name } } } }').then((function(n){var t=(n.searchEpisodes||[]).filter((function(n){return parseFloat(n.number)===parseFloat(e)}));return 0===t.length?null:(1===t.length||t.sort((function(n,e){var t=function(n){if(!n.timestamps)return 0;var e=0,t=n.timestamps.map((function(n){return n.type?n.type.name.toLowerCase():""}));return t.some((function(n){return-1!==n.indexOf("new intro")||-1!==n.indexOf("new credits")}))&&(e+=50),t.some((function(n){return-1!==n.indexOf("intro")||-1!==n.indexOf("op")||-1!==n.indexOf("opening")}))&&(e+=10),t.some((function(n){return-1!==n.indexOf("ending")||-1!==n.indexOf("ed")||-1!==n.indexOf("credits")}))&&(e+=10),e+n.timestamps.length};return t(e)-t(n)})),t[0].timestamps)})).catch((function(){return null}))}(n,f):e()})).then((function(r){if(!r)return e();var i=function(n){if(!n||!n.length)return[];n.sort((function(n,e){return n.at-e.at}));for(var e=[],r=0;r<n.length;r++){var i=n[r],a=n[r+1],o=i.type?i.type.name:"Unknown";t.some((function(n){return-1!==o.toLowerCase().indexOf(n.toLowerCase())}))&&a&&e.push({start:i.at,end:a.at,name:o})}return e}(r);i.length>0&&(o(n,i),n.playlist&&Array.isArray(n.playlist)&&n.playlist.forEach((function(n){n.episode!==f&&n.e!==f||o(n,i)}))),e()})).catch((function(n){e()}))}))}function u(){if(!window.lampa_animeskip_v10){window.lampa_animeskip_v10=!0;var n=Lampa.Player.play;Lampa.Player.play=function(e){var t=this;Lampa.Loading.start((function(){Lampa.Loading.stop()})),s(e).then((function(){Lampa.Loading.stop(),n.call(t,e)})).catch((function(r){Lampa.Loading.stop(),n.call(t,e)}))}}}window.Lampa&&window.Lampa.Player?u():window.document.addEventListener("app_ready",u)}();
