!function(){"use strict";const e="https://api.anime-skip.com/graphql",t="ZGfO0sMF3eCwLYf8yMSCJjlynwNGRXWE",n=["Intro","New Intro","Op","Opening","Recap","Credits","New Credits","Ed","Ending","Preview"];async function a(n){try{const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Client-ID":t},body:JSON.stringify({query:n})}),i=await a.json();if(i.errors)throw new Error(i.errors[0].message);return i.data}catch(e){throw e}}async function i(e){try{const t=`{ searchShows(search: "${e}", limit: 1) { id name } }`,n=await a(t);if(n.searchShows&&n.searchShows.length>0)return n.searchShows[0].id}catch(e){}return null}async function s(e){let t=[];e.original_title&&t.push(e.original_title),e.original_name&&t.push(e.original_name),e.title&&t.push(e.title),e.name&&t.push(e.name),t=[...new Set(t)].filter((e=>e));for(const e of t){const t=await i(e);if(t)return t}const n=await async function(e){if(!window.Lampa||!window.Lampa.TMDB)return null;const t=e.name||e.original_name?"tv":"movie",n=e.id;if(!n)return null;const a=Lampa.TMDB.api(`${t}/${n}?api_key=${Lampa.TMDB.key()}&language=en-US`);try{const e=await fetch(a),t=await e.json();return t.name||t.title}catch(e){return null}}(e);if(n){let e=await i(n);if(e)return e;const t=(a=n)?a.replace(/\(\d{4}\)/g,"").replace(/\(TV\)/gi,"").replace(/Season \d+/gi,"").replace(/[:\-]/g," ").replace(/\s+/g," ").trim():"";if(t!==n&&(e=await i(t),e))return e}var a;return null}function r(e,t){e&&"object"==typeof e&&(e.segments&&"object"==typeof e.segments&&!Array.isArray(e.segments)||(e.segments={}),e.segments.skip&&Array.isArray(e.segments.skip)||(e.segments.skip=[]),t.forEach((t=>{e.segments.skip.some((e=>e.start===t.start))||e.segments.skip.push(t)})))}async function o(e){let t=e.movie||e.card;if(!t){const e=Lampa.Activity.active();e&&(t=e.movie||e.card)}let i=e.episode||e.e||e.episode_number;if(!t)return;if(!i){t.number_of_seasons>0||t.original_name&&!t.original_title||(i=1)}i||(i=1);const o=await s(t);if(!o)return;const c=await async function(e,t){const n=`{\n            searchEpisodes(search: "", showId: "${e}", limit: 100) {\n                number\n                timestamps { at type { name } }\n            }\n        }`;try{const e=((await a(n)).searchEpisodes||[]).filter((e=>parseFloat(e.number)===parseFloat(t)));return 0===e.length?null:(1===e.length||e.sort(((e,t)=>{const n=e=>{if(!e.timestamps)return 0;let t=0;const n=e.timestamps.map((e=>e.type?e.type.name.toLowerCase():""));return n.some((e=>e.includes("new intro")||e.includes("new credits")))&&(t+=50),n.some((e=>e.includes("intro")||e.includes("op")||e.includes("opening")))&&(t+=10),n.some((e=>e.includes("ending")||e.includes("ed")||e.includes("credits")))&&(t+=10),t+=e.timestamps.length,t};return n(t)-n(e)})),e[0].timestamps)}catch(e){return null}}(o,i);if(!c)return;const l=function(e){if(!e||!e.length)return[];e.sort(((e,t)=>e.at-t.at));let t=[];for(let a=0;a<e.length;a++){const i=e[a],s=e[a+1],r=i.type?i.type.name:"Unknown";n.some((e=>r.toLowerCase().includes(e.toLowerCase())))&&s&&t.push({start:i.at,end:s.at,name:r})}return t}(c);l.length>0&&(r(e,l),e.playlist&&Array.isArray(e.playlist)&&e.playlist.forEach((e=>{e.episode!==i&&e.e!==i||r(e,l)})))}function c(){if(window.lampa_animeskip_v10)return;window.lampa_animeskip_v10=!0;const e=Lampa.Player.play;Lampa.Player.play=function(t){Lampa.Loading.start((()=>{Lampa.Loading.stop()})),o(t).then((()=>{Lampa.Loading.stop(),e.call(this,t)})).catch((n=>{Lampa.Loading.stop(),e.call(this,t)}))}}window.Lampa&&window.Lampa.Player?c():window.document.addEventListener("app_ready",c)}();
