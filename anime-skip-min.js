!function(){"use strict";var n="https://api.anime-skip.com/graphql",e="ZGfO0sMF3eCwLYf8yMSCJjlynwNGRXWE",t=["Intro","New Intro","Op","Opening","Recap","Credits","New Credits","Ed","Ending","Preview"];function r(n){return n?n.replace(/\(\d{4}\)/g,"").replace(/\(TV\)/gi,"").replace(/Season \d+/gi,"").replace(/Part \d+/gi,"").replace(/[:\-]/g," ").replace(/\s+/g," ").trim():""}function a(n){return["","I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"][n]||null}function i(t){return fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Client-ID":e},body:JSON.stringify({query:t})}).then((function(n){return n.json()})).then((function(n){if(n.errors)throw new Error(n.errors[0].message);return n.data})).catch((function(n){throw n}))}function s(n){if(!n)return 0;var e=0,t=n.map((function(n){return n.type?n.type.name.toLowerCase():""}));return t.some((function(n){return-1!==n.indexOf("new intro")}))&&(e+=50),t.some((function(n){return-1!==n.indexOf("intro")||-1!==n.indexOf("op")}))&&(e+=10),t.some((function(n){return-1!==n.indexOf("credits")||-1!==n.indexOf("ed")}))&&(e+=10),e+=n.length}function o(n,e,t){return function(n){return new Promise((function(e){if(!window.Lampa||!window.Lampa.TMDB)return e(null);var t=n.name||n.original_name?"tv":"movie",r=n.id;if(!r)return e(null);var a=Lampa.TMDB.api(t+"/"+r+"?api_key="+Lampa.TMDB.key()+"&language=en-US");fetch(a).then((function(n){return n.json()})).then((function(n){e(n.name||n.title)})).catch((function(){e(null)}))}))}(n).then((function(o){var u=[];o&&u.push(r(o)),n.original_name&&u.push(r(n.original_name)),n.name&&u.push(r(n.name)),u=u.filter((function(n,e){return u.indexOf(n)===e&&n}));var c=[];return u.forEach((function(n){if(e>1){var t=a(e);t&&c.push({q:n+" "+t,type:"specific"}),c.push({q:n+" Season "+e,type:"specific"}),c.push({q:n+" "+e,type:"specific"})}c.push({q:n,type:"broad"})})),function n(r){return r>=c.length?Promise.resolve(null):i('{ searchShows(search: "'+c[r].q.replace(/"/g,'\\"')+'", limit: 5) { id name } }').then((function(o){var u=(o.searchShows||[]).filter((function(n){return function(n,e){var t=n.toLowerCase();if(1===e)return!/\b(season\s*[2-9]|part\s*[2-9]|\d+nd|\d+rd|\d+th)\b/.test(t)&&!/\b(ii|iii|iv|v)\b/.test(t);var r=a(e);return-1!==t.indexOf("season "+e)||!!new RegExp("\\b"+e+"(nd|rd|th)\\s+season").test(t)||!(!r||!new RegExp("\\b"+r.toLowerCase()+"\\b").test(t))||!!new RegExp("\\s"+e+"$").test(t)}(n.name,e)}));if(0===u.length)return n(r+1);var c=u.map((function(n){return function(n,e){return i('{ searchEpisodes(search: "", showId: "'+n+'", limit: 200) { number timestamps { at type { name } } } }').then((function(n){var t=n.searchEpisodes||[],r=null,a=0,i=t.filter((function(n){return parseFloat(n.number)===parseFloat(e)}));i.length>0&&(i.sort((function(n,e){return s(e.timestamps)-s(n.timestamps)})),a=s((r=i[0]).timestamps));var o=t.length,u=(r?2*a:-100)+o;return{timestamps:r?r.timestamps:null,score:u,epCount:o,markerScore:a}})).catch((function(){return{score:-999,timestamps:null}}))}(n.id,t).then((function(e){return e.showName=n.name,e.showId=n.id,e}))}));return Promise.all(c).then((function(e){e.sort((function(n,e){return e.score-n.score}));var t=e[0];return t.score>-50&&t.timestamps?t.timestamps:n(r+1)}))}))}(0)}))}function u(n,e){n&&"object"==typeof n&&(n.segments&&"object"==typeof n.segments&&!Array.isArray(n.segments)||(n.segments={}),n.segments.skip&&Array.isArray(n.segments.skip)||(n.segments.skip=[]),e.forEach((function(e){n.segments.skip.some((function(n){return n.start===e.start}))||n.segments.skip.push(e)})))}function c(n){return new Promise((function(e){var r=n.movie||n.card;if(!r){var a=Lampa.Activity.active();a&&(r=a.movie||a.card)}if(!r)return e();var i=(r.original_language||"").toLowerCase();if("ja"!==i&&"zh"!==i)return e();var s=parseInt(n.season||n.s||(r.season_number?r.season_number:1)||1),c=parseInt(n.episode||n.e||n.episode_number||1);isNaN(s)&&(s=1),o(r,s,c).then((function(r){if(r){var a=function(n){if(!n||!n.length)return[];n.sort((function(n,e){return n.at-e.at}));for(var e=[],r=0;r<n.length;r++){var a=n[r],i=n[r+1],s=a.type?a.type.name:"Unknown";t.some((function(n){return-1!==s.toLowerCase().indexOf(n.toLowerCase())}))&&i&&e.push({start:a.at,end:i.at,name:s})}return e}(r);a.length>0&&(u(n,a),n.playlist&&Array.isArray(n.playlist)&&n.playlist.forEach((function(n){n.episode!==c&&n.e!==c||u(n,a)})))}e()})).catch((function(n){e()}))}))}function p(){if(!window.lampa_animeskip_final){window.lampa_animeskip_final=!0;var n=Lampa.Player.play;Lampa.Player.play=function(e){var t=this;Lampa.Loading.start((function(){Lampa.Loading.stop()})),c(e).then((function(){Lampa.Loading.stop(),n.call(t,e)})).catch((function(){Lampa.Loading.stop(),n.call(t,e)}))}}}window.Lampa&&window.Lampa.Player?p():window.document.addEventListener("app_ready",p)}();
